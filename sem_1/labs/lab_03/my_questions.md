1) Системный вызов pipe: что создаётся и для чего, особенности.

Системный вызов pipe создает неименованный программный канал.


Программный канал - буфер типа FIFO в области данных ОС.


Он располагается именно там, а не в области данных какого-либо процесса, т.к. адресные пространства процессов защищены (т.е. через такой буфер не смогут общаться разные процессы, даже родственные).


Неименованный программный канал не имеет имени, но имеет дескриптор.


Неименованный программный канал используется для обмена сообщениями (только) между процессами-родственниками, т.к. в результате системного вызова fork потомки наследуют от предков дескрипторы открытых файлов, а программный канал - это файл (в Linux всё файл).



2) Системный вызов exec: для чего введён, какие действия выполняет, прежде чем будет запущена новая программа

Системный вызов exec переводит процесс на новое адресное пространство программы, которая передана ему в качестве параметра.

Как он выполняется:
1) проверяет, существует ли файл с именем, которое ему передали;
2) проверяет, исполняемый ли он (~для этого надо прочитать заголовок файла~);
3) проверяет, есть ли у процесса, который выполняет системный вызов exec, права на его запуск;
4) создаётся новое адресное пространство, т.е. создаются таблицы страниц для программы, переданной exec в качестве параметра;
5) удалить старые таблицы страниц, указатель на которые содержится в дескрипторе процесса;
6) поменять указатель на новые таблицы страниц;
7) загрузить в регистр IP начальный адрес программы (~или адрес точки входа программы, или просто точку входа программы~), а в регистр CR3 загрузить адрес таблиц страниц из дескриптора процесса (в дескрипторе мы поменяли адрес таблиц страниц, но его ещё надо загрузить в CR3), чтобы можно было выполнять страничное преобразование, которое нужно для адресации кода.

Загрузка CR3 нужна только в процессорах Intel.

Результат: будет выполняться новая программа.

Если exec был вызван в потомке, то у предка флаг copy on write будет сброшен и права доступа вернутся к read-write.
